---
title: Logbook for analysis of SCT and twin language data
author: Dorothy Bishop
date: started August 2018
output: html_document
---


`r Sys.time()`

```{r load_packages, include = FALSE}
#################################################################################
#devtools::install_github("rubenarslan/formr")
require(formr) #to handle conflicts with 'select' function in dplyr (may not be needed)
library(tidyverse)
library(reshape2)  #for melt
library(knitr) #for kable - allows nice tables in Word output - but can be temperamental
library(gridExtra)
library(grid)
library(Hmisc)
library(doBy)
library(lme4) #linear model
library(lmerTest) #Adding this extra package provides p-values (if you want them) for your fixed effects.
library(ggridges) #for joyplot
library(car)
require(psych)
library(beeswarm) #particular plot type
library(beanplot) #ditto
library(yarrr) #for pirate plot - another plot type
library(lavaan) #for SEM to extract language factor
library(semPlot) #used with Lavaan
library(standardize)
#################################################################################

```


Need to create a main analysis file in which we have a code that corresponds to group.
Have col for trisomy which corresponds to XXX, XXY, XYY, and NA: NA will be twins
Makes sense to use randomtwininclude to select just one from each pair
For trisomies, have a col that specifies whether highbias or lowbias

Have a col that determines if meeting criteria for DLD - regardless of whether twin or not.
This can be same criterion as for doppler paper : this was:
<i>Results from the language/cognitive test battery were used to categorise children as having DLD if they scored more than 1 SD below population norms on two or more out of 13 language/literacy measures, and as TD if they scored below this threshold on no more than one measure. In previous studies, we have excluded children who met this criterion solely on literacy measures (TOWRE and NARA-II); 
Children were excluded from the sample if they met any of the following criteria: WASI nonverbal ability (performance IQ) more than two SDs below the population mean; diagnosis of autism spectrum disorder (ASD) in one or both twins; sensorineural hearing loss or failure of a hearing test on the day of testing; and brain injury or a serious medical condition affecting one or both twins.</i>

nb index of multiple deprivation from postcode (English)
http://imd-by-postcode.opendatacommunities.org/

Also see re: CCC-2 nonresponse rates - https://www.aapor.org/About-Us/History/Presidential-Addresses/2004-Presidential-Address.aspx

## Step 1
Read in latest SCT from redcap.
Do the same for the twins.
Select variables to be used.


```{r readredcap}
#########################################################################################
redcap.dir <-"~/Dropbox/ERCadvanced/project SCT analysis/Data from Redcap/"
#Use latest version - now includes milestones
sct.redcap <- 'SCTDATA_DATA_2018-08-13_1234.csv'
#updated to include code indicating whether participated in prior study
twin.redcap <- 'TwinsData_DATA_2018-08-13_1234.csv' #updated to include ccc2_consistent variable
#also now has pheno_include, which selects individual twins for inclusion
sct.data <- read.csv(paste0(redcap.dir,sct.redcap),stringsAsFactors = FALSE)
twin.data <- read.csv(paste0(redcap.dir,twin.redcap),stringsAsFactors = FALSE)

#fix any columns with discrepant names
w<-which(colnames(twin.data)=='neurodev_diagnosis')
colnames(twin.data)[w] <-'neurodev_diag'
#Nb Coded so if you subtract 1 you get N older sibs: disregards birth order of twins
w<-which(colnames(sct.data)=='position_in_family')
colnames(sct.data)[w] <-'fam_position'

twin.data$dyslexia<-twin.data$dld_rd%%10 #modulus 10 , ie last digit
twin.data$lang_disorder<-round((twin.data$dld_rd-4.5)/10) #first digit is dld code

#add gender info to sct data so it merges properly
sct.data$female<-0
w<-which(sct.data$trisomy==1)
sct.data$female[w]<-1
#########################################################################################
#----------------------------------------------------------------------------------
```

#Select data for short file

```{r colselect}
#########################################################################################
#Specify columns to retain that are common to both sct and twin
#NB we are using oromotor_ss2, which is renormed against the TD twin group
keepcols <- c('record_id','female','age_at_test','partial_testing','pass_hearing','wasi_matrices_ss','wasi_block_design_ss','wasi_vocab_ss','wdck_jhsn_ss',
              'sent_rep_ss','oromotor_ss_2','nonword_rep_ss','nara_acc_ss',      'nara_comp_ss','nara_rate_ss','towre_words_ss','towre_nonwords_ss','phab_pic_ss','phab_digit_ss','srs_t_score','slt','splang_conc','schooling','piq','neurodev_diag','dyslexia','lang_disorder',
              'hyperkinetic_icd_r1','adhd_comb_dsm_r1','adhd_hyp_dsm_r1','adhd_inatt_dsm_r1',
              'conduct_dsm_r1','asd_dsm_r1','autism_icd_r1','srs_t_score',
              'gcc','scdi','ccc_a','ccc_b','ccc_c','ccc_d','ccc_e','ccc_f',
              'ccc_g','ccc_h','ccc_i','ccc_j','ccc2_consistent','mo_educ','fa_educ','deprivation_index','fam_structure','fam_position','wordcode','sentcode','walkcode','drycode')

twin.short <- select(twin.data,keepcols)
sct.short <- select(sct.data,keepcols) #NB 'select' is ambiguous between packages but should work ok if we use formr (otherwise need dplyr::select)
#########################################################################################

```

```{r wrangledata}
#----------------------------------------------------------------------------------

#Add columns that are specific to twins or SCTs so all aligned
sct.short$randomtwininclude <- 0 #this specifies child is not a twin but a trisomy
sct.short$zygosity <- NA
twin.short$randomtwininclude <- twin.data$randomtwininclude+1 #twins subdivided
#randomly into 1 and 2 for replication sample
twin.short$zygosity <- twin.data$zygosity
#2 ASD, 3 ASDsib, 4 fail hearing screen (35dB plus mean for better ear), 5 other (rare condition)
#The previous include variable was used for Doppler paper and had more stringent hearing criteria.

sct.short$trisomy <- sct.data$trisomy
sct.short$pre_postnatal_diag <- sct.data$pre_postnatal_diag
sct.short$why_tested <-sct.data$why_tested
sct.short$orig_famcode<-0
sct.short$orig_famcode[sct.data$orig_famcode>0]<-1 #if seen before this is 1
twin.short$trisomy <- NA
twin.short$pre_postnatal_diag <- NA
twin.short$why_tested <- NA
twin.short$orig_famcode<-NA
twin.short$splang_conc<-twin.data$splang_conc
sct.short$splang_conc<-NA
sct.short$pheno_include<-1
twin.short$pheno_include<-twin.data$pheno_include #this codes reason for exclusion as:
#2 ASD, 3 ASD-sib, 4-hearing, 5- other
#----------------------------------------------------------------------------------
#Bolt SCT and twin files together
all.short <-rbind(sct.short,twin.short)

#remove case of isochromosome
w<-which(all.short$trisomy==9)
all.short<-all.short[-w,]

all.short<-all.short[all.short$pheno_include==1,] #removes those with ASD, ASD-sib,hearing, other

#rename age variable
w<-which(colnames(all.short)=='age_at_test')
colnames(all.short)[w]<-'Age'

#########################################################################################
```


## Step 2

#Check that Ns match those in the protocol
Should have three groups with N = 142 SCT, 194 twin1 and 194 twin2 (these are randomly assigned twin 1 and 2), - but Ns less for twins because of exclusions
Numbers are greater than for Newbury et al, as some children did not feature in that study because of lack of DNA.

Twins recruited in relation to splang_conc, which is coded as
0, never
1, preschool only
2, continuing, mild
3, continuing, severe
4, reading concerns only
9, unclear
We will be using this categorisation to subdivide twins; categories 2 and 3 distinguished.

Trisomies - divided according to reason for diagnosis
why tested used to make bias column: coded as: 
0, maternal age
1, medical concerns
2, behavioural concerns
3, neurodevelopmental concerns
4, family history of genetic problems
9, no information

```{r ncheck}
###################################################################################
twintab <- table(all.short$randomtwininclude)
names(twintab)<-c('SCT','twin1','twin2')

all.short$bias<-'NA'
w<-which(all.short$randomtwininclude==0)
all.short$bias[w]<-0
w<-c(which(all.short$why_tested==2),which(all.short$why_tested==3))
all.short$bias[w]<-1
scttab <- table(all.short$trisomy,all.short$bias)
rownames(scttab)<-c('XXX','XXY','XYY')
colnames(scttab)<-c('low bias','high bias','NA')
#Show tables
twintab
scttab
rowSums(scttab)

all.short$parentconc<-NA #parental concern re language
w<-which(all.short$randomtwininclude>0)
all.short$parentconc[w]<-0
w<-which(all.short$splang_conc%in%c(2,3))
all.short$parentconc[w]<-1

parcontab<-table(all.short$parentconc,all.short$randomtwininclude)
parcontab<-parcontab[,2:3]
rownames(parcontab)<-c('No concern','Concern')
colnames(parcontab)<-c('twin1','twin2')
parcontab
print('Age range (min, max, average) for SCT')
min(sct.data$age_at_test)
max(sct.data$age_at_test)
mean(sct.data$age_at_test)
print('Age range (min, max, average) for twin')
min(twin.data$age_at_test)
max(twin.data$age_at_test)
mean(twin.data$age_at_test)

#count how many SCT cases were in the earlier 2009 study (Bishop et al 2011 paper)
print('')
print('In 2009 study')
w<-which(all.short$orig_famcode==1)
origstudy<-table(all.short$bias[w],all.short$trisomy[w])
colnames(origstudy)<-c('XXX','XXY','XYY')
rownames(origstudy)<-c('Low bias','High bias')
origstudy
###################################################################################
```
##Step 3
#Deal with missing data
Check for nonword rep - in some cases need to substitute low score, as unable to attempt task. 
N.B. The process used to extract the language factor can handle missing data, so for measures used in that, we just substitute NA for values > 900.
```{r missingcheck}

all.short$pass_hearing[all.short$pass_hearing==9]<-NA #change 9 to NA for pass_hearing
#NB these include both refusal and equipment failure

#missing data has codes of 996-999 for language tests
w <- which(all.short$nonword_rep_ss>900)
print('Cases with missing nonword rep data: ')
all.short$record_id[w]
#These cases all checked : all SCT cases who either were not tested because v limited spoken language, or who refused spoken tests or had low scores on other language tests. All these cases assigned a scaled score of 3.
all.short$nonword_rep_ss[w] <- 3

#999 is code where child was not tested bcs too low-functioning
w <- which(all.short$wasi_vocab_ss==999)
print('Cases with missing Vocab data (999) reassigned to floor: ')
all.short$record_id[w]
#These assigned SS of 2.33 SD below mean (equivalent to 3 on NEPSY scale)
all.short$wasi_vocab_ss[w] <- 25

w <- which(all.short$wdck_jhsn_ss==999)
print('Cases with missing Woodcock_J data (999) reassigned to floor: ')
all.short$record_id[w]
#These assigned SS of 2.33 SD below mean (equivalent to 3 on NEPSY scale)
all.short$wdck_jhsn_ss[w] <- 55

w <- which(all.short$sent_rep_ss==999)
print('Cases with missing Sent rep data (999) reassigned to floor:: ')
all.short$record_id[w]
#These assigned SS of 2.33 SD below mean (equivalent to 3 on NEPSY scale)
all.short$sent_rep_ss[w] <- 3

w <- which(all.short$oromotor_ss==999)
print('Cases with missing oromotor data (999) reassigned to floor:: ')
all.short$record_id[w]
#These assigned SS of 1 , as this corresponds to floor in this sample
all.short$oromotor_ss[w] <- 1

#Now substitute NA for any remaining test scores > 900
mycols<-colnames(all.short)
#Identify the range of columns where 900+ is missing data code
mc <-which(mycols=='wasi_matrices_ss')
mc2<-which(mycols=='ccc_j')
for (i in mc:mc2){
  w <- which(all.short[,i]>900)
  all.short[w,i]<-NA
  
}
#Parental educ variables, missing is 9
w<-which(all.short$mo_educ==9)
all.short$mo_educ[w]<-NA
w<-which(all.short$fa_educ==9)
all.short$fa_educ[w]<-NA
 #NB Deprivation index: will be missing for Wales/Scotland and NI

md <- which(is.na(all.short[,mc:(mc+3)]))
print(paste0(length(md),' missing values from ',nrow(all.short)*4,' datapoints in 4 language tests'))
```

##Create 8 groups:
1. XXX-nobias
2. XXY-nobias
3. XYY-nobias
4. XXX-hibias
5. XXY-hibias
6. XYY-hibias
7. twin_noconcern
8. twin_concern
NB as currently defined, not taking into account co-twin status. So a twin_noconcern could have cotwin with concern, ie have family risk.

```{r groupcreate}
#####################################################################################
all.short<-filter(all.short,randomtwininclude<2) #remove twin2
all.short$group8<-all.short$trisomy
w<-which(all.short$bias==1)
all.short$group8[w]<-all.short$group8[w]+3 #convert 1 2 3 to 4 5 6
w<-which(all.short$randomtwininclude>0)
all.short$group8[w]<-7
w<-which(all.short$parentconc==1)
all.short$group8[w]<-8
all.short$group8level<-all.short$group8#useful to retain numeric code before converting to factor
all.short$group8<-as.factor(all.short$group8)
levels(all.short$group8)<-c('XXX.lowbias','XXY.lowbias','XYY.lowbias',
                            'XXX.hibias','XXY.hibias','XYY.hibias',
                            'twin.TD','twin.langconcerns')
```
##Covariates
a)	Educational level of mother and father, transformed into an ordinal scale based on age at leaving full-time education/qualifications obtained, with points of 0 (prior to age 16 years), 1 (16 years/did GCSE or O-levels), 2 (18 years/ did A-levels), 3 (21 years, degree), 4 (postgraduate study). 

b)	An index of multiple deprivation based on postcode was obtained for those living in England from the website http://imd-by-postcode.opendatacommunities.org/. This uses local statistics from the Department for Communities and Local Government to rank over 32,000 postcodes on the basis of a weighted sum based on income, employment, education, health, crime, housing and living environment. The rank score was converted to a z-score to give a normally-distributed variable.  

c)	Living with single parent, coded as a binary variable (0 or 1), based on status at the time of the initial interview.

d)	Number of older siblings. For twins, the co-twin was not counted.

N.B. The finding that the lowbias SCT children are more likely to have older sibs is probably related to the fact that pre-natal testing is associated with older parents. We do have data on parental ages and could look at that, but not sure it's necessary. It does, though, make me concerned that there may be problems in using N older sibs as a covariate, as it could look causal when it is not. It might be reasonable to use it just within the twin group.

```{r get.covariates}
#Parental educational level
par.ed <-aggregate(all.short$mo_educ, by=list(all.short$group8),
                   FUN=mean, na.rm=TRUE)
pirateplot(mo_educ~group8,data=all.short)
pirateplot(fa_educ~group8,data=all.short)

#Deprivation index
#pirateplot(deprivation_index~group8,data=all.short,main='Deprivation index: high is good')

#Can generate deciles, but better to normalise deprviation index as below
#depcut<-3275*c(1,2,3,4,5,6,7,8,9)
# print('Deprivation index decile cutpoints are:')
# print(depcut)
# pirateplot(deprivation_index~mo_educ,data=all.short,main='Deprivation index: high is good')

#Use ranks to convert to normal distribution
#Rw deprivation index is a rank out of 32750
all.short$deprivz<-qnorm(all.short$deprivation_index/32750)

pirateplot(deprivz~group8,data=all.short,xaxt='n')
text(1,3.2,'XXX',cex=.8)
text(2,3.2,'XXY',cex=.8)
text(3,3.2,'XYY',cex=.8)
text(4,3.2,'XXX',cex=.8)
text(5,3.2,'XXY',cex=.8)
text(6,3.2,'XYY',cex=.8)
text(7,3.4,'Twin\nno concerns',cex=.8)
text(8,3.2,'Twin\nlanguage\nproblems ',cex=.8)
text(2,-3,'<-------Low bias------->')
text(5,-3,'<-------High bias------->')
all.short$singlepar<-0
all.short$singlepar[all.short$fam_structure<3]<-1
singlepar.tab<-table(all.short$group8,all.short$singlepar)
colnames(singlepar.tab)<-c('2 parents','single parent')
prop.table(singlepar.tab,1)

print('N older siblings')
all.short$oldersibs<-all.short$fam_position-1
nsib.tab<-table(all.short$group8,all.short$oldersibs)
round(prop.table(nsib.tab,1),3)
```
##Analyse language test and reading data
First select the data and convert to common scale

```{r langmeasures}


langcogcols<-c("wasi_matrices_ss" ,"wasi_block_design_ss", "wasi_vocab_ss" ,
               "wdck_jhsn_ss" , "sent_rep_ss" ,  "oromotor_ss_2","nonword_rep_ss", 
               "nara_acc_ss" ,"nara_comp_ss","nara_rate_ss" ,"towre_words_ss",
               "towre_nonwords_ss","phab_pic_ss","phab_digit_ss")
#Note we now are using the oromotor_ss_2 variable: normed against TD twins

langcols<-which(colnames(all.short)%in%langcogcols)
#NB this finds columns corresponding to langcogcols, but they will be in the order they occur in file

#Make shorter names for plotting - create new variables on same scale for this
shortlangnames<-c('Matrices','Blocks','Vocab','Comprehnsn','SentRep','Oromotor','NwdRep',
                     'ReadAcc','ReadComp','ReadRate','TOWREwd','TOWREnwd',
                     'PicName','DigitName')
ncol<-length(colnames(all.short))
#convert all variables to same scale: mean 100 and SD 15
#This has to be hard coded because different tests on different scales

#start by just duplicating original scaled scores
nnew<-length(shortlangnames)
all.short[,(ncol+1):(ncol+nnew)]<-all.short[,langcols]
colnames(all.short)[(ncol+1):(ncol+nnew)]<-shortlangnames
#First 3 are normed with mean 50 and SD 10
for (i in 1:3){
  oldmean<-50
  oldsd<-10
  all.short[,(i+ncol)]<- 100+15*(all.short[,langcols[i]]-oldmean)/oldsd
}

for (i in c(5,7)){
  oldmean<-10
  oldsd<-3
   all.short[,(i+ncol)]<- 100+15*(all.short[,langcols[i]]-oldmean)/oldsd
}

```

Now make shorter sctfile that excluded the high bias group

```{r exclude.hibias}
lobias.sct<-filter(all.short,group8level<4) #we're using numeric code for factor level to make this easier
lobias.sct$Group<-as.factor(lobias.sct$group8level)
levels(lobias.sct$Group)<-c('XXX','XXY','XYY')

twin.only<-filter(all.short,group8level>6) #we're using numeric code for factor level to make this easier
twin.only$Group<-as.factor(twin.only$group8level)
levels(twin.only$Group)<-c('TD','Lang.concern')
```

#Now do a grid of beeswarm plots

```{r beeswarmgrid}
longname<-c('Matrices','Block Design','Vocabulary','Comprehension','Sentence Repetition','Nonword Repetition','Oromotor',
                     'Reading Accuracy','Reading Comprehension','Reading Rate','Speeded word reading','Speeded nonword reading',
                     'Rapid Naming: Pictures','Rapid Naming: Digits')

png_lang_bees<-'beeswarm_lang.png' #name to save png file
png(png_lang_bees,width=1000,height=1000)
par(mfrow=c(5,3)) #5 row and 3 columns
par(mar=c(5.1,4.1,4.1,0.2))

for (i in 1:14){
  mytitle<-longname[i]
beeswarm(lobias.sct[,langcols[i]]~Group , data = lobias.sct, xlab='Trisomy',ylab='Scaled score',
         pch = 16,cex=1.7,col=2,main=mytitle,ylim=c(50,130))
bxplot(lobias.sct[,langcols[i]]~Group , data = lobias.sct, probs = 0.5, col = 1,add=TRUE) #adds medians
abline(a=100,b=0,col='darkgray',lty=1)
abline(a=85,b=0,col='darkgray',lty=2)
abline(a=70,b=0,col='darkgray',lty=2)

mean_TD<-mean(twin.only[twin.only$Group=="TD",langcols[i]],na.rm=T)
  sd_TD<-sd(twin.only[twin.only$Group=="TD",langcols[i]],na.rm=T)
  
  up.lim<-mean_TD+sd_TD
  low.lim<-mean_TD-sd_TD
  
  polygon(c(0,0,4,4), c(up.lim, low.lim, low.lim, up.lim),
          col=adjustcolor("yellow",alpha.f=0.3), border = NA)

}
dev.off()
```
![Beeswarm plots](beeswarm_lang.png)
#Effect sizes
For 3 trisomy groups and twin LD group, compute effect size for mean difference from twin TD group. First divide into boys and girls and look at relative to same sex reference group.

I'm having some trouble with formatting this. I only want the Y labels for group 1, but that means adjusting margins, and then if they are different for the groups, they are scaled differently.
I have used workaround by creating a null group, but this has an x-axis from -1 to 1 which takes up unnecessary space and is hard to suppress.
Use of xlim also doesn't seem to work to equate range of scales. Also tried ylim, as this is a sideways barplot, in case x and y are transposed, but still no joy.

So currently it gives an idea of what it looks like, but I'm not sure I will continue with this. I think heatmap may be preferable, so will try that first.


```{r lang.manova}
#First just do groups 1-3


Y <- as.matrix(lobias.sct[,langcols])
lobias.fit <- manova(Y ~ lobias.sct$Group+lobias.sct$mo_educ)
mymanova<-summary(lobias.fit, test="Pillai")
print('Manova on the 14 language measures for the Low Bias SCT group')
mymanova

```
##CCC-2 analysis
Consider how CCC-2 profiles for SCTs compare with those in our previous paper. Also include twins with or without concerns as comparison group.  Show both subscales and the GCC and SIDC.

```{r ccc2}
w<-which(colnames(all.short)=='ccc_a')
x<-which(colnames(all.short)=='group8')
y<-which(colnames(all.short)=='group8level')
cccbit<-all.short[,c(1,(w-2):(w+10),x,y)]#2 before ccc_a is GCC and SIDC
w<-which(is.na(cccbit$ccc2_consistent))
cccbit$ccc2_consistent[w]<--1 #we need a count of missing data, so convert NA to -1
consistent.ccc<-table(cccbit$group8,cccbit$ccc2_consistent)

colnames(consistent.ccc)<-c('No data','Inconsistent','Consistent')
consistent.ccc
print('Proportions of non-response to CCC-2')
print(paste('All low bias SCT:',sum(consistent.ccc[1:3,1])/sum(consistent.ccc[1:3,])))
print(paste('All high bias SCT:',sum(consistent.ccc[4:6,1])/sum(consistent.ccc[4:6,])))
print(paste('Twin: no concerns:',sum(consistent.ccc[7,1])/sum(consistent.ccc[7,])))
print(paste('Twin: language concerns:',sum(consistent.ccc[8,1])/sum(consistent.ccc[8,])))

#total responses

print(paste('All SCT:',1-sum(consistent.ccc[1:6,1])/sum(consistent.ccc[1:6,])))
print(paste('Twin:',1-sum(consistent.ccc[7:8,1])/sum(consistent.ccc[7:8,])))

```
##Now analyse CCC-2 for 8 groups

```{r ccc.analyse}
#First remove the cases with no response or inconsistent
ccc.data<-filter(cccbit,ccc2_consistent>0)
#create dataframe for results
ccc.df<-data.frame(matrix(NA,nrow=8,ncol=30))
ccc.df[,1]<-levels(ccc.data$group8)
ccc.df[,2]<- table(ccc.data$group8)
thiscol<- 1
for (i in 1:12){
  thiscol<-thiscol+2
  thisdat<-ccc.data[,i+1]
  ag <- aggregate(thisdat~ group8, ccc.data, function(x) c(mean = mean(x), se = sd(x)/sqrt(length(x))))
  ccc.df[,(thiscol:(thiscol+1))]<-ag[,2]
}
colnames(ccc.df)<-c('Group','N','GCC.mean','GCC.se','SIDC.mean','SIDC.se','A.mean','A.se','B.mean','B.se','C.mean','C.se','D.mean','D.se',
                    'E.mean','E.se','F.mean','F.se','G.mean','G.se','H.mean','H.se',
                    'I.mean','I.se','J.mean','J.se')
```

```{r cccplot}
#Need data in long form for ggplot2
#set up the long form df with data from scale A
ccc.dflong<-ccc.df[1:8,c(1,2,2,7:8)]
colnames(ccc.dflong)[3:5]<-c('scale','mean','se')
ccc.dflong$scale<-1
mybase<-ccc.dflong

#Now bolt on the other scales
for (j in 2:10){
  #rows to write to in new long df
  startrow<-(j-1)*8+1
  endrow<-(j*8)
  #cols to read from in old df
  startcol<-7+(j-1)*2
  ccc.dflong<-rbind(ccc.dflong,mybase) #just duplicate first 8 rows before overwriting them
  ccc.dflong$scale[startrow:endrow]<-j
  ccc.dflong[startrow:endrow,4:5]<-ccc.df[,startcol:(startcol+1)]
  
}
ccc.dflong$scale<-as.factor(ccc.dflong$scale)
levels(ccc.dflong$scale)<-c('A','B','C','D','E','F','G','H','I','J')
linetypes<-c(1,1,1,2,2,2,1,1)
ccc.dflong$lines<-as.factor(linetypes)
ccc.dflong$plotgroup<-rep(c('XXX','XXY','XYY','XXX','XXY','XYY','twin_typical','twin_concerns'),10)

#Plot the means
ymax <- 12
ymin <- 0
cccplot<-ggplot(ccc.dflong, aes(x=scale, y=mean, colour=plotgroup,group=Group)) +
  geom_line(aes(linetype=lines)) + geom_point(shape=21, fill="white") + 
  ylim(ymin,ymax)
cccplot+geom_errorbar(width=.1, aes(ymin=mean-se, ymax=mean+se))
```
##Manova for CCC-2
Follow https://www.statmethods.net/stats/anova.html

```{r ccc2.manova}
#First just do groups 1-3
ccc.gp3<-filter(ccc.data,group8level<4)
colA<-which(colnames(ccc.gp3)=='ccc_a')

Y <- as.matrix(ccc.gp3[,colA:(colA+9)])
fit3 <- manova(Y ~ ccc.gp3$group8)
summary(fit3, test="Pillai")

#Now add group 8
temp<-filter(ccc.data,group8level==8)
ccc.gp4<-rbind(ccc.gp3,temp)
Y <- as.matrix(ccc.gp4[,colA:(colA+9)])
fit4 <- manova(Y ~ ccc.gp4$group8)
summary(fit4, test="Pillai")
```



##Session information
```{r sessinfo}
sessionInfo()
```